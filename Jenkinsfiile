pipeline {
    agent any
    
    environment {
        GITHUB_REPO_URL = "https://M95kandan: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@github.com/M95kandan/test_website.git"
        DOCKERHUB_USERNAME = "m95kandan"
        DOCKERHUB_PASSWORD = "M#95kandan"
        DOCKERHUB_REPOSITORY = "m95kandan/website"
        BUILD_NUMBER_TAG = "${BUILD_NUMBER}"
    }
    
    stages {
        stage('Clone Repository') {
            steps {
                checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '', url: env.GITHUB_REPO_URL]]])
            }
        }
        
        stage('Build and Push Docker Image') {
            steps {
                script {
                    ansiblePlaybook(
                        playbook: '/path/to/your/playbook.yml',
                        inventory: '/path/to/your/inventory',
                        extraVars: [
                            github_repo_url: env.GITHUB_REPO_URL,
                            dockerhub_username: env.DOCKERHUB_USERNAME,
                            dockerhub_password: env.DOCKERHUB_PASSWORD,
                            dockerhub_repository: env.DOCKERHUB_REPOSITORY,
                            build_number_tag: env.BUILD_NUMBER_TAG
                        ]
                    )
                }
            }
        }
    }
}
